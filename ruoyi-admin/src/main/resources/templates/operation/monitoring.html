<!DOCTYPE html>
<html lang="en">
<!DOCTYPE html>
<html  lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!--360浏览器优先以webkit内核解析-->
    <title>AI_FEED</title>
    <link rel="shortcut icon" href="favicon.ico">
    <link href="../../static/css/bootstrap.min.css" th:href="@{/css/bootstrap.min.css}" rel="stylesheet"/>
    <link href="../../static/css/font-awesome.min.css" th:href="@{/css/font-awesome.min.css}" rel="stylesheet"/>
    <link href="../../static/css/main/animate.min.css" th:href="@{/css/main/animate.min.css}" rel="stylesheet"/>
    <link href="../../static/css/main/style.min862f.css" th:href="@{/css/main/style.min862f.css}" rel="stylesheet"/>
    <link href="../../static/css/video/video-js.css" th:href="@{/css/video/video-js.min.css}" rel="stylesheet"/>
    <link href="../../static/css/normalize.min.css" th:href="@{/css/normalize.min.css}" rel="stylesheet"/>
    <link href="../../static/css/button.css" th:href="@{/css/button.css}" rel="stylesheet"/>
    <!--echarts 可视化图形 插件-->
    <script th:src="@{/js/plugins/echarts/echarts.min.js}"></script>
    <script th:src="@{/js/plugins/echarts/echarts-gl.min.js}"></script>
    <script th:src="@{/js/plugins/video/video.min.js}"></script>
</head>
<body class="gray-bg" >
<div class="wrapper wrapper-content">
    <div class="row">
    <div class="col-sm-8">
    <div class="ibox float-e-margins">
        <div class="ibox-title">
            <h5>视频播放</h5>
            <div class="ibox-tools">
                <a class="collapse-link">
                    <i class="fa fa-chevron-up"></i>
                </a>
                <a class="dropdown-toggle" data-toggle="dropdown" href="form_basic.html#">
                    <i class="fa fa-wrench"></i>
                </a>
                <ul class="dropdown-menu dropdown-user">
                    <li><a href="form_basic.html#">选项1</a>
                    </li>
                    <li><a href="form_basic.html#">选项2</a>
                    </li>
                </ul>
                <a class="close-link">
                    <i class="fa fa-times"></i>
                </a>
            </div>
        </div>
        <div class="ibox-content">
            <video id="example_video_1" class="video-js vjs-default-skin" controls preload="none" width="900" height="500"
                   poster="http://video-js.zencoder.com/oceans-clip.png"
                   data-setup="{}">
                <source src="rtmp://47.94.238.110:1935/hls/test" type='rtmp/flv' />
                <track kind="captions" src="demo.captions.vtt" srclang="en" label="English"></track><!-- Tracks need an ending tag thanks to IE9 -->
                <track kind="subtitles" src="demo.captions.vtt" srclang="en" label="English"></track><!-- Tracks need an ending tag thanks to IE9 -->
            </video>
            <!--<article style="border:1px solid white;width:400px;height:400px;margin:0 auto;background-color:white;">

                <section class="experiment" style="width:320px; height:240px;border:1px solid green; margin:50px auto;">
                    <div id="videos-container" style="width:320px; height:240px;">
                    </div>
                </section>
                <section class="experiment" style="text-align:center;border:none; margin-top:20px;">
                    <button id="openCamera">打开摄像头</button>
                    <button id="start-recording" disabled>开始录制</button>
                    <button id="save-recording" disabled>保存</button>
                    &lt;!&ndash;<a href="javascript:void(0)" onclick="send()">发送</a>&ndash;&gt;
                </section>
            </article>
            <script>
                var mediaStream;
                var recorderFile;
                var stopRecordCallback;
                var openBtn = document.getElementById("openCamera");
                var startBtn = document.getElementById("start-recording");
                var saveBtn = document.getElementById("save-recording");
                openBtn.onclick = function() {
                    this.disabled = true;
                    startBtn.disabled=false;
                    openCamera();
                };

                startBtn.onclick = function() {
                    this.disabled = true;
                    startRecord();
                };

                saveBtn.onclick = function() {
                    saver();

                    // alert('Drop WebM file on Chrome or Firefox. Both can play entire file. VLC player or other players may not work.');
                };

                var mediaRecorder;
                var videosContainer = document.getElementById('videos-container');

                function openCamera(){
                    var len = videosContainer.childNodes.length;
                    for(var i=0;i<len;i++){
                        videosContainer.removeChild(videosContainer.childNodes[i]);
                    }

                    var video = document.createElement('video');

                    var videoWidth = 320;
                    var videoHeight = 240;

                    video.controls = false;
                    video.muted = true;
                    video.width = videoWidth;
                    video.height = videoHeight;
                    MediaUtils.getUserMedia(true, false, function (err, stream) {
                        if (err) {
                            throw err;
                        } else {
                            // 通过 MediaRecorder 记录获取到的媒体流
                            console.log();
                            mediaRecorder = new MediaRecorder(stream);
                            mediaStream = stream;
                            var chunks = [], startTime = 0;
                            video.srcObject = stream;
                            video.play();

                            videosContainer.appendChild(video);
                            mediaRecorder.ondataavailable = function(e) {
                                mediaRecorder.blobs.push(e.data);
                                chunks.push(e.data);
                            };
                            mediaRecorder.blobs = [];

                            mediaRecorder.onstop = function (e) {
                                recorderFile = new Blob(chunks, { 'type' : mediaRecorder.mimeType });
                                chunks = [];
                                if (null != stopRecordCallback) {
                                    stopRecordCallback();
                                }
                            };
                        }
                    });
                }

                // 停止录制
                function stopRecord(callback) {
                    stopRecordCallback = callback;
                    // 终止录制器
                    mediaRecorder.stop();
                    // 关闭媒体流
                    MediaUtils.closeStream(mediaStream);
                }

                var MediaUtils = {
                    /**
                     * 获取用户媒体设备(处理兼容的问题)
                     * @param videoEnable {boolean} - 是否启用摄像头
                     * @param audioEnable {boolean} - 是否启用麦克风
                     * @param callback {Function} - 处理回调
                     */
                    getUserMedia: function (videoEnable, audioEnable, callback) {
                        navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia
                            || navigator.msGetUserMedia || window.getUserMedia;
                        var constraints = {video: videoEnable, audio: audioEnable};
                        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                            navigator.mediaDevices.getUserMedia(constraints).then(function (stream) {
                                callback(false, stream);
                            })['catch'](function(err) {
                                callback(err);
                            });
                        } else if (navigator.getUserMedia) {
                            navigator.getUserMedia(constraints, function (stream) {
                                callback(false, stream);
                            }, function (err) {
                                callback(err);
                            });
                        } else {
                            callback(new Error('Not support userMedia'));
                        }
                    },

                    /**
                     * 关闭媒体流
                     * @param stream {MediaStream} - 需要关闭的流
                     */
                    closeStream: function (stream) {
                        if (typeof stream.stop === 'function') {
                            stream.stop();
                        }
                        else {
                            let trackList = [stream.getAudioTracks(), stream.getVideoTracks()];

                            for (let i = 0; i < trackList.length; i++) {
                                let tracks = trackList[i];
                                if (tracks && tracks.length > 0) {
                                    for (let j = 0; j < tracks.length; j++) {
                                        let track = tracks[j];
                                        if (typeof track.stop === 'function') {
                                            track.stop();
                                        }
                                    }
                                }
                            }
                        }
                    }
                };

                function startRecord() {
                    mediaRecorder.start();
                    setTimeout(function(){
                        // 结束
                        stopRecord(function() {
                            alert("录制成功!");
                            openBtn.disabled=false;
                            saveBtn.disabled=false;
                            //send();
                        });
                    }, 5000);
                }

                function saver(){
                    var file = new File([recorderFile], 'msr-' + (new Date).toISOString().replace(/:|\./g, '-') + '.mp4', {
                        type: 'video/mp4'
                    });
                    saveAs(file);
                }

                function send(){
                    var file = new File([recorderFile], 'msr-' + (new Date).toISOString().replace(/:|\./g, '-') + '.mp4', {
                        type: 'video/mp4'
                    });
                    var data = new FormData();
                    data.append("username", "test");
                    data.append("userfile", file);

                    var req = new XMLHttpRequest();
                    req.open("POST", "com.spinsoft.bip.frame.utils.image.saveMp4.biz.ext");
                    req.send(data);
                }

            </script>-->
        </div>
    </div>
    </div>
    <div class="col-sm-4">
        <div class="row">
            <div class="ibox float-e-margins" >
                <div class="ibox-content">
                    <h2 class="text-center">投食</h2>
                    <div class="smile-rating-container">
                        <div class="smile-rating-toggle-container">
                            <form class="submit-rating">
                                <input id="meh"  name="satisfaction" type="radio" onclick="connectWS(this.value)" value="10"/>
                                <input id="fun" name="satisfaction" type="radio" onclick="connectWS(this.value)" value="09"/>

                                <label for="meh" class="rating-label rating-label-meh" >OFF</label>
                                <div class="smile-rating-toggle" ></div>
                                <div class="rating-eye rating-eye-left" ></div>
                                <div class="rating-eye rating-eye-right"></div>
                                <div class="mouth rating-eye-bad-mouth"></div>
                                <div class="toggle-rating-pill"></div>
                                <label for="fun" class="rating-label rating-label-fun"  >NO</label>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="ibox float-e-margins" >
                <div class="ibox-content">
                    <h2 class="text-center">喂水</h2>
                    <div class="smile-rating-container">
                        <div class="smile-rating-toggle-container">
                            <form class="submit-rating">
                                <input id="meh2"  name="satisfaction2" type="radio" onclick="connectWS(this.value)" value="12"/>
                                <input id="fun2" name="satisfaction2" type="radio" onclick="connectWS(this.value)" value="11"/>

                                <label for="meh2" class="rating-label rating-label-meh2" >OFF</label>
                                <div class="smile-rating-toggle" ></div>
                                <div class="rating-eye rating-eye-left" ></div>
                                <div class="rating-eye rating-eye-right"></div>
                                <div class="mouth rating-eye-bad-mouth"></div>
                                <div class="toggle-rating-pill"></div>
                                <label for="fun2" class="rating-label rating-label-fun2"  >NO</label>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
</div>
<script th:src="@{/js/plugins/video/video.min.js}"></script>
<script th:src="@{/js/view/operation/monitoring.js}"></script>
<script th:src="@{/js/view/operation/fileSaver.js}"></script>
</body>
</html>
